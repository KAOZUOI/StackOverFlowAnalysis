private static BufferedImage blur(BufferedImage img) {    for (int x=0; x<img.getWidth(); x++) {        for (int y=0; y<img.getHeight(); y++) {            int y0 = Math.max(y-1, 0);            int y1 = y;            int y2 = Math.min(y+2, img.getHeight()-1);            short s0 = ((short[]) img.getRaster().getDataElements(x, y0, null))[0];            short s1 = ((short[]) img.getRaster().getDataElements(x, y1, null))[0];            short s2 = ((short[]) img.getRaster().getDataElements(x, y2, null))[0];            s0 += 32768; // ADDED LINE            s1 += 32768; // ADDED LINE            s2 += 32768; // ADDED LINE                        short sNew = (short) ((s0 + s1 + s2) / 3);            sNew -= 32768; // ADDED LINE            img.getRaster().setDataElements(x, y, new short[] {(short)sNew});        }    }        for (int x=0; x<img.getWidth(); x++) {        for (int y=0; y<img.getHeight(); y++) {            int x0 = Math.max(x-1, 0);            int x1 = x;            int x2 = Math.min(x+2, img.getWidth()-1);            short s0 = ((short[]) img.getRaster().getDataElements(x0, y, null))[0];            short s1 = ((short[]) img.getRaster().getDataElements(x1, y, null))[0];            short s2 = ((short[]) img.getRaster().getDataElements(x2, y, null))[0];            s0 += 32768; // ADDED LINE            s1 += 32768; // ADDED LINE            s2 += 32768; // ADDED LINE                        short sNew = (short) ((s0 + s1 + s2) / 3);            sNew -= 32768; // ADDED LINE            img.getRaster().setDataElements(x, y, new short[] {(short)sNew});        }    }    return img;}